<!DOCTYPE html>
<html style="height: 100%;">

<head>
  <meta charset='UTF-8'>
  <title>Experimentos CSCN</title>
  <link rel="stylesheet" href="jsPsych-6/css/jspsych.css">
</head>

<body id="general_body" style="height:100%;" class=" jspsych-display-element">

  <!-- Main JsPsych library -->
  <script src="jsPsych-6/jspsych.js"></script>
  <!-- esentials plugins -->
  <script src="jsPsych-6/plugins/jspsych-call-function.js"></script>
  <script src="jsPsych-6/plugins/jspsych-preload.js"></script>

  <!-- Protocol Plugins -->
  <script src="jsPsych-6/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="jsPsych-6/plugins/jspsych-survey-multi-choice-horizontal.js"></script>
  <script src="jsPsych-6/plugins/jspsych-survey-multi-choice-vertical.js"></script>
  <script src="jsPsych-6/plugins/jspsych-survey-multi-select.js"></script>
  <script src="jsPsych-6/plugins/jspsych-html-button-response.js"></script>
  <script src="jsPsych-6/plugins/jspsych-image-button-response.js"></script>
  <script src="jsPsych-6/plugins/jspsych-fullscreen.js"></script>
  <script src="jsPsych-6/plugins/jspsych-instructions.js"></script>
  <script src="jsPsych-6/plugins/jspsych-external-html.js"></script>
  <script src="jsPsych-6/plugins/jspsych-survey-text.js"></script>
  <script src="jsPsych-6/plugins/jspsych-html-slider-response.js"></script>
  <script src="jsPsych-6/plugins/jspsych-survey-html-form.js"></script>

  <script src="controllers/js/script_loading.js"></script>

  <!-- Database initialization and control -->
  <script src="controllers/js/mysql_controller.js"></script>
  <script src="controllers/js/indexedDB_controller.js"></script>
  <script src="controllers/js/save_data.js"></script>

  <!-- Protocol Configuration -->
  <script src="config.js"></script>

  <!-- General Options -->
  <script>

  // Parameters - Do not change ----------------------------------
    check = true; // REVIEW: ??? que es esto? (lo a√±adi yo pq daba un error)

    let params = new URLSearchParams(location.search);
    uid = -1;
    uid_external = -1;

    iterations_for_review = 1; // usado para bloquear el experimento en caso de que se superen todas las condiciones
    random = false; // REVIEW: Dado que usamos tres variables (first_tasks, randomly_ordered_tasks y last_tasks), este parametro es redundante, no?

    between_selection = {};
    within_selection = {};
    completed_experiments = [];
    user_assigned = false;

    actual_condition_data = [];

    // REVIEW: Ver arriba. No entiendo esto...
    // obtaining final array (if random)
    var all_tasks = (random) ? (['Consent'].concat(first_tasks.concat(jsPsych.randomization.shuffle(randomly_ordered_tasks)))) : (['Consent'].concat(first_tasks.concat(randomly_ordered_tasks)));
    all_tasks = all_tasks.concat(last_tasks);

    // Create tasks Array for DB
    for(var i= 0; i < all_tasks.length; i++) {
      if (i === 0) var tasks = []
      tasks_temp = [{ id_protocol: pid, task_name: all_tasks[i]}]
      tasks = tasks.concat(tasks_temp)
    }

    // Use IndexedDB or MySQL for offline or online protocols
    if (online) {
      start_mysqldb(pid, max_participants);
      load_clean_mysql(iterations_for_review, max_participants);
    } else {
      load_clean_indexeddb(iterations_for_review, max_participants);
    }

  </script>

  <div class="jspsych-content-wrapper">
    <div id="jspsych-content" class="jspsych-content">
      <div title="logo">
        <p style="margin-bottom: 0.2in; line-height: 100%">
          <img src="media/img/logo-trans-UAI.png" name="UAI" align="bottom" width="185" height="47" border="0"/>
        </p>
      </div>
      LA INTRO DEBERIA SER TAMBIEN UNA VARIABLE DEL config.js?<BR><BR>

      Si tienes alguna duda, puedes escribirnos a: CORREO<BR><BR>

      Te recomendamos usar <a href = "https://www.google.com/chrome/">Google Chrome <img src="media/img/compatible_chrome.gif" name="Chrome" align="bottom" border="0"/></a> para continuar.<BR><BR>

      <div class="jspsych-instructions-nav" style="padding: 10px 0px;">

        <span id="text_input_uid" hidden="true"></span>
        <input id="input_uid" type="hidden" required></input>
        <input id="start" type="button" onclick="start_protocol(questions)" value="Continuar" class="jspsych-btn" hidden='true'></input>
      </div>
    </div>
  </div>

  <script>
    id_random = jsPsych.randomization.randomID(20);
    document.getElementById("input_uid").value = id_random;
  </script>

  <!-- PROTOCOL MACHINERY -->
  <script src="controllers/js/protocol_controller.js"></script>
  <script> window.onload = check_id_status(); </script>
  <script type="text/javascript" src="controllers/js/css_loading.js"></script>

  </body>
</html>
